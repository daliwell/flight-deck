<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Deck - Badge Printing</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <h1>‚úàÔ∏è Flight Deck</h1>
                <span class="subtitle">Badge Printing & Attendee Management</span>
            </div>
            <div class="header-right">
                <button id="userInfoBtn" class="user-info-btn">
                    <span id="userInfo" class="user-info">Loading...</span>
                </button>
                <button id="printerSettingsBtn" class="btn btn-secondary">
                    <span class="btn-icon">üñ®Ô∏è</span> Printer
                </button>
            </div>
        </header>

        <!-- Event Selection Screen -->
        <div id="eventSelectionScreen" class="screen active">
            <div class="screen-content">
                <h2>Select Event</h2>
                <p class="instructions">Choose the event you're currently working at</p>
                
                <div class="controls">
                    <button id="refreshEventsBtn" class="btn btn-primary">
                        <span class="btn-icon">üîÑ</span> Refresh Events
                    </button>
                    <select id="genreFilter" class="filter-select">
                        <option value="RHEINGOLD">Rheingold Conferences</option>
                        <option value="CAMP">Camps</option>
                        <option value="FLEX_CAMP">Flex Camps</option>
                        <option value="ALL">All Types</option>
                    </select>
                </div>

                <div id="eventsLoading" class="loading-state" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading events...</p>
                </div>

                <div id="eventsError" class="error-state" style="display: none;"></div>

                <div id="eventsList" class="events-list"></div>
            </div>
        </div>

        <!-- Attendee Management Screen -->
        <div id="attendeeScreen" class="screen">
            <div class="screen-content">
                <div class="attendee-header">
                    <button id="backToEventsBtn" class="btn btn-secondary">
                        <span class="btn-icon">‚Üê</span> Back to Events
                    </button>
                    <div class="current-event-info">
                        <h2 id="currentEventName"></h2>
                        <p id="currentEventDetails"></p>
                    </div>
                    <button id="syncAttendeesBtn" class="btn btn-primary">
                        <span class="btn-icon">üîÑ</span> Sync Attendees
                    </button>
                </div>

                <div class="search-section">
                    <div class="search-tabs">
                        <button class="tab-btn active" data-tab="search">
                            <span class="tab-icon">üîç</span> Search
                        </button>
                        <button class="tab-btn" data-tab="scan">
                            <span class="tab-icon">üì∑</span> Scan QR Code
                        </button>
                    </div>

                    <!-- Search Tab -->
                    <div id="searchTab" class="tab-content active">
                        <div class="search-box">
                            <input 
                                type="text" 
                                id="attendeeSearch" 
                                placeholder="Search by name or badge number..." 
                                autocomplete="off"
                            />
                            <button id="clearSearchBtn" class="clear-btn" style="display: none;">‚úï</button>
                        </div>
                        <div id="searchResults" class="search-results"></div>
                    </div>

                    <!-- Scan Tab -->
                    <div id="scanTab" class="tab-content">
                        <div class="scan-container">
                            <div id="qrScanner" class="qr-scanner">
                                <video id="qrVideo" class="qr-video"></video>
                                <div class="scan-overlay">
                                    <div class="scan-frame"></div>
                                </div>
                            </div>
                            <button id="startScanBtn" class="btn btn-primary btn-large">
                                <span class="btn-icon">üì∑</span> Start Scanner
                            </button>
                            <button id="stopScanBtn" class="btn btn-secondary btn-large" style="display: none;">
                                <span class="btn-icon">‚èπ</span> Stop Scanner
                            </button>
                            <p class="scan-instructions">Position the QR code within the frame</p>
                        </div>
                    </div>
                </div>

                <div id="attendeeDetails" class="attendee-details" style="display: none;">
                    <!-- Attendee details will be dynamically inserted here -->
                </div>

                <div id="syncStatus" class="sync-status"></div>
            </div>
        </div>

        <!-- Badge Print Modal -->
        <div id="printModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Print Badge</h3>
                    <button class="modal-close" onclick="flightDeckApp.closePrintModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <div id="badgePreview" class="badge-preview"></div>
                    <div class="print-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="testPrintCheckbox" />
                            <span>Test Print (don't mark as printed)</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="flightDeckApp.closePrintModal()">Cancel</button>
                    <button id="confirmPrintBtn" class="btn btn-primary btn-large">
                        <span class="btn-icon">üñ®Ô∏è</span> Print Badge
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Printer Settings Modal -->
    <div id="printerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üñ®Ô∏è Printer Settings</h3>
                <button class="modal-close" onclick="flightDeckApp.closePrinterModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div id="printerStatus" class="printer-status">
                    <p class="status-text">No printer connected</p>
                    <button id="scanPrinterBtn" class="btn btn-primary">
                        <span class="btn-icon">üîç</span> Scan for Printers
                    </button>
                </div>
                <div id="printerInfo" class="printer-info" style="display: none;">
                    <div class="info-row">
                        <strong>Connected Printer:</strong>
                        <span id="printerName"></span>
                    </div>
                    <div class="printer-actions">
                        <button id="testPrinterBtn" class="btn btn-secondary">
                            <span class="btn-icon">üß™</span> Test Print
                        </button>
                        <button id="disconnectPrinterBtn" class="btn btn-secondary">
                            <span class="btn-icon">üîå</span> Disconnect
                        </button>
                    </div>
                </div>
                <div class="printer-help">
                    <p><strong>Setup Instructions:</strong></p>
                    <ol>
                        <li>Turn on your Brother QL-820NWB printer</li>
                        <li>Enable Bluetooth pairing mode on the printer</li>
                        <li>Click "Scan for Printers" and select your printer</li>
                        <li>Test the connection with "Test Print"</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Load database service first -->
    <script src="services/db.js"></script>
    <!-- Load printer service -->
    <script src="services/printer.js"></script>
    <!-- Load main application -->
    <script src="script.js"></script>
</body>
</html>
